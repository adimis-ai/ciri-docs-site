"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[2812],{7962(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"use-cases/code-refactor","title":"Code Refactor Flow (Human-in-the-loop)","description":"This tutorial demonstrates a common developer workflow where CIRI proposes a code fix or refactor, you review it, and CIRI applies it and runs tests.","source":"@site/docs/use-cases/code-refactor.md","sourceDirName":"use-cases","slug":"/use-cases/code-refactor","permalink":"/docs/use-cases/code-refactor","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/use-cases/code-refactor.md","tags":[],"version":"current","frontMatter":{}}');var s=t(4848),o=t(8453);const a={},i="Code Refactor Flow (Human-in-the-loop)",c={},l=[];function p(e){const n={code:"code",h1:"h1",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"code-refactor-flow-human-in-the-loop",children:"Code Refactor Flow (Human-in-the-loop)"})}),"\n",(0,s.jsx)(n.p,{children:"This tutorial demonstrates a common developer workflow where CIRI proposes a code fix or refactor, you review it, and CIRI applies it and runs tests."}),"\n",(0,s.jsxs)(n.p,{children:["Real-world scenario: rename function ",(0,s.jsx)(n.code,{children:"compute_score"})," to ",(0,s.jsx)(n.code,{children:"score_compute"})," across the codebase and update tests."]}),"\n",(0,s.jsx)(n.p,{children:"Mermaid flow"}),"\n",(0,s.jsx)(n.mermaid,{value:'sequenceDiagram\n  participant Dev\n  participant CIRI\n  participant CopilotGraph\n  participant PatchMaker\n  participant Filesystem\n  participant TestRunner\n  Dev->>CIRI: "Rename compute_score to score_compute"\n  CIRI->>CopilotGraph: plan (use skills: code-analysis, patch-creator)\n  CopilotGraph->>PatchMaker: generate patch (diff)\n  PatchMaker--\x3e>CIRI: show patch (human approval required)\n  Dev--\x3e>CIRI: Approve\n  CopilotGraph->>Filesystem: apply patch (write files)\n  CopilotGraph->>TestRunner: run pytest\n  TestRunner--\x3e>Dev: test results'}),"\n",(0,s.jsx)(n.p,{children:"Step-by-step"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start CIRI:"}),"\n",(0,s.jsx)(n.p,{children:"ciri"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Ask it to rename the function:"}),"\n",(0,s.jsxs)(n.p,{children:["Rename ",(0,s.jsx)(n.code,{children:"compute_score"})," to ",(0,s.jsx)(n.code,{children:"score_compute"})," across the repo and update tests."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Review the proposed diff shown in the prompt and approve."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"CIRI will apply the changes and run pytest; inspect failures and iterate."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Implementation pointers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Patch generation uses high-level middleware and skills that produce diffs; look for patch helpers in ",(0,s.jsx)(n.code,{children:"src/middlewares"})," or ",(0,s.jsx)(n.code,{children:".ciri/skills/patch"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"The human-in-the-loop middleware (HumanInTheLoopMiddleware in deepagents) enforces approval before write operations."}),"\n",(0,s.jsx)(n.li,{children:"Tests are invoked programmatically (the agent may call pytest as a subprocess); prefer running tests locally in a venv for debugging."}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const s={},o=r.createContext(s);function a(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);