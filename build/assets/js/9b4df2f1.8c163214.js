"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[9213],{6947(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"internals/controller","title":"Copilot Controller","description":"The CopilotController is the primary interface for executing the CIRI agent graph. It handles conversation threads, state management, and multimodal input processing.","source":"@site/docs/internals/controller.md","sourceDirName":"internals","slug":"/internals/controller","permalink":"/docs/internals/controller","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/internals/controller.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Core Harness Architecture","permalink":"/docs/architecture/core-harness"},"next":{"title":"Middleware Stack","permalink":"/docs/internals/middlewares"}}');var r=t(4848),i=t(8453);const d={},o="Copilot Controller",a={},c=[{value:"The <code>run</code> Method",id:"the-run-method",level:2},{value:"Multimodal Input Support",id:"multimodal-input-support",level:3},{value:"1. Using <code>HumanMessage</code>",id:"1-using-humanmessage",level:4},{value:"2. Using Dictionary Format",id:"2-using-dictionary-format",level:4},{value:"Supported Content Blocks",id:"supported-content-blocks",level:3},{value:"Thread Management",id:"thread-management",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"copilot-controller",children:"Copilot Controller"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"CopilotController"})," is the primary interface for executing the CIRI agent graph. It handles conversation threads, state management, and multimodal input processing."]}),"\n",(0,r.jsxs)(n.h2,{id:"the-run-method",children:["The ",(0,r.jsx)(n.code,{children:"run"})," Method"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"run"})," method is the core entry point for interacting with the agent. It accepts various input types and yields a stream of events from the LangGraph execution."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def run(\n    self,\n    inputs: Union[MessagesState, HumanMessage, Command],\n    config: RunnableConfig,\n    *,\n    context: Optional[Any] = None,\n    subgraphs: Optional[bool] = True,\n    serialize: bool = False,\n) -> AsyncGenerator[tuple[tuple[str, ...], str, Any], None]:\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multimodal-input-support",children:"Multimodal Input Support"}),"\n",(0,r.jsxs)(n.p,{children:["CIRI supports passing multimodal content (audio, images, and files) through the ",(0,r.jsx)(n.code,{children:"run"})," method. You can provide these either as LangChain ",(0,r.jsx)(n.code,{children:"HumanMessage"})," objects or as raw dictionaries that follow the LangChain message format."]}),"\n",(0,r.jsxs)(n.h4,{id:"1-using-humanmessage",children:["1. Using ",(0,r.jsx)(n.code,{children:"HumanMessage"})]}),"\n",(0,r.jsxs)(n.p,{children:["You can construct a ",(0,r.jsx)(n.code,{children:"HumanMessage"})," with multiple content blocks:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from langchain_core.messages import HumanMessage\n\n# Message with Text and Audio\naudio_message = HumanMessage(\n    content=[\n        {"type": "text", "text": "Transcribe this audio clip."},\n        {\n            "type": "audio",\n            "url": "https://example.com/audio.mp3",\n            "mime_type": "audio/mpeg"\n        }\n    ]\n)\n\n# Message with Text and a File (e.g., PDF)\nfile_message = HumanMessage(\n    content=[\n        {"type": "text", "text": "Summarize this document."},\n        {\n            "type": "file",\n            "base64": "AAAAIGZ0eXBtcD...",  # Base64 encoded content\n            "mime_type": "application/pdf"\n        }\n    ]\n)\n\n# Execute\nasync for namespace, stream_type, chunk in controller.run(audio_message, config):\n    # Process stream...\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-using-dictionary-format",children:"2. Using Dictionary Format"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"CopilotController"})," automatically deserializes dictionary inputs into the appropriate LangChain message types."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'inputs = {\n    "messages": [\n        {\n            "role": "user",\n            "content": [\n                {"type": "text", "text": "Analyze this file."},\n                {\n                    "type": "file",\n                    "url": "https://example.com/data.csv",\n                    "mime_type": "text/csv"\n                }\n            ]\n        }\n    ]\n}\n\nasync for namespace, stream_type, chunk in controller.run(inputs, config):\n    # Process stream...\n'})}),"\n",(0,r.jsx)(n.h3,{id:"supported-content-blocks",children:"Supported Content Blocks"}),"\n",(0,r.jsx)(n.p,{children:"CIRI supports the standard LangChain content blocks:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Parameters"}),(0,r.jsx)(n.th,{children:"Default MIME Types"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"text"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"text"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"text/plain"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"image"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"url"}),", ",(0,r.jsx)(n.code,{children:"base64"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"image/jpeg"}),", ",(0,r.jsx)(n.code,{children:"image/png"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"audio"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"url"}),", ",(0,r.jsx)(n.code,{children:"base64"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"audio/mpeg"}),", ",(0,r.jsx)(n.code,{children:"audio/wav"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"video"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"url"}),", ",(0,r.jsx)(n.code,{children:"base64"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"video/mp4"}),", ",(0,r.jsx)(n.code,{children:"video/webm"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"file"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"url"}),", ",(0,r.jsx)(n.code,{children:"base64"})]}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"application/pdf"}),", ",(0,r.jsx)(n.code,{children:"text/csv"}),", etc."]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"thread-management",children:"Thread Management"}),"\n",(0,r.jsx)(n.p,{children:"The controller also provides helper methods for managing SQLite-backed conversation threads:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"list_threads()"}),": Returns all available threads."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create_thread()"}),": Initializes a new persistent thread."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"delete_thread(thread_id)"}),": Removes a thread and its history."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"get_state(config)"}),": Retrieves the current Graph state for a thread."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>d,x:()=>o});var s=t(6540);const r={},i=s.createContext(r);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);