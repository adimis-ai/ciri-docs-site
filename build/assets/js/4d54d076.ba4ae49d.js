"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[1459],{2199(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"contributing","title":"Contributing to Ciri","description":"Thank you for your interest in making Ciri better. This guide covers how to set up a development environment, the project structure, contribution workflows, and how to extend Ciri with new skills, toolkits, and subagents.","source":"@site/docs/contributing.md","sourceDirName":".","slug":"/contributing","permalink":"/docs/contributing","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/contributing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Roadmap","permalink":"/docs/roadmap"},"next":{"title":"Security & Privacy","permalink":"/docs/security"}}');var r=i(4848),t=i(8453);const l={},d="Contributing to Ciri",c={},o=[{value:"Ways to Contribute",id:"ways-to-contribute",level:2},{value:"Development Setup",id:"development-setup",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Clone and Install",id:"clone-and-install",level:3},{value:"Set Up API Keys",id:"set-up-api-keys",level:3},{value:"Run Ciri",id:"run-ciri",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"Code Style",id:"code-style",level:2},{value:"Testing",id:"testing",level:2},{value:"PR Workflow",id:"pr-workflow",level:2},{value:"Commit Message Convention",id:"commit-message-convention",level:3},{value:"Adding a Built-in Skill",id:"adding-a-built-in-skill",level:2},{value:"Adding a Built-in Subagent",id:"adding-a-built-in-subagent",level:2},{value:"Adding a Middleware",id:"adding-a-middleware",level:2},{value:"Documentation",id:"documentation",level:2},{value:"Reporting Bugs",id:"reporting-bugs",level:2},{value:"Code of Conduct",id:"code-of-conduct",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"contributing-to-ciri",children:"Contributing to Ciri"})}),"\n",(0,r.jsx)(n.p,{children:"Thank you for your interest in making Ciri better. This guide covers how to set up a development environment, the project structure, contribution workflows, and how to extend Ciri with new skills, toolkits, and subagents."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ways-to-contribute",children:"Ways to Contribute"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bug reports"})," \u2014 detailed reproduction steps help enormously"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation improvements"})," \u2014 correct inaccuracies, add examples, expand thin sections"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"New built-in skills"})," \u2014 add a skill to ",(0,r.jsx)(n.code,{children:"src/skills/"})," for the community"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"New subagents"})," \u2014 add specialized agent configs to ",(0,r.jsx)(n.code,{children:"src/subagents/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Core improvements"})," \u2014 middleware, CLI, persistence, streaming"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tests"})," \u2014 we always need more coverage"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"development-setup",children:"Development Setup"}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Python 3.12+"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://docs.astral.sh/uv/",children:"uv"})," (recommended) or pip"]}),"\n",(0,r.jsx)(n.li,{children:"Git"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"clone-and-install",children:"Clone and Install"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'git clone https://github.com/adimis-ai/ciri.git\ncd ciri/ciri-cli-v1\n\n# Install with uv (recommended)\nuv sync\n\n# Or with pip in a virtualenv\npython -m venv .venv\nsource .venv/bin/activate\npip install -e ".[dev]"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"set-up-api-keys",children:"Set Up API Keys"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export ANTHROPIC_API_KEY="sk-ant-..."  # or your preferred provider\n'})}),"\n",(0,r.jsx)(n.h3,{id:"run-ciri",children:"Run Ciri"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Via uv\nuv run ciri\n\n# Or directly\npython -m src\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ciri-cli-v1/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __main__.py          # CLI entrypoint, REPL, CiriCompleter\n\u2502   \u251c\u2500\u2500 agent.py             # Ciri agent class, tool registration, MiddlewareBuilder\n\u2502   \u251c\u2500\u2500 copilot.py           # create_copilot() \u2014 full LangGraph assembly\n\u2502   \u251c\u2500\u2500 controller.py        # CiriController \u2014 stream, run, state management\n\u2502   \u251c\u2500\u2500 middlewares/         # All custom middleware classes\n\u2502   \u2502   \u251c\u2500\u2500 memory.py        # MemoryMiddleware\n\u2502   \u2502   \u251c\u2500\u2500 skills.py        # SkillsMiddleware + bootstrap\n\u2502   \u2502   \u251c\u2500\u2500 subagents.py     # SubAgentMiddleware\n\u2502   \u2502   \u251c\u2500\u2500 toolkits.py      # ToolkitInjectionMiddleware\n\u2502   \u2502   \u2514\u2500\u2500 inject_names.py  # InjectAvailable{Tool,SubAgent,Skill}NamesMiddleware\n\u2502   \u251c\u2500\u2500 subagents/           # Built-in subagent implementations\n\u2502   \u2502   \u251c\u2500\u2500 trainer_agent.py\n\u2502   \u2502   \u251c\u2500\u2500 skill_builder.py\n\u2502   \u2502   \u251c\u2500\u2500 toolkit_builder.py\n\u2502   \u2502   \u251c\u2500\u2500 subagent_builder.py\n\u2502   \u2502   \u2514\u2500\u2500 web_researcher.py\n\u2502   \u251c\u2500\u2500 toolkit/             # Built-in tools\n\u2502   \u2502   \u251c\u2500\u2500 web_crawler_tool.py\n\u2502   \u2502   \u251c\u2500\u2500 script_executor_tool.py\n\u2502   \u2502   \u2514\u2500\u2500 human_follow_up_tool.py\n\u2502   \u251c\u2500\u2500 skills/              # Built-in skill packages (SKILL.md per skill)\n\u2502   \u2514\u2500\u2500 utils.py             # Shared utilities, harness dir helpers, autocomplete discovery\n\u251c\u2500\u2500 docs-site/               # Docusaurus documentation site\n\u251c\u2500\u2500 tests/                   # Test suite\n\u2514\u2500\u2500 pyproject.toml           # Build config, dependencies\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"code-style",children:"Code Style"}),"\n",(0,r.jsxs)(n.p,{children:["We use ",(0,r.jsx)(n.strong,{children:"ruff"})," for linting and ",(0,r.jsx)(n.strong,{children:"black"})," for formatting:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Lint (with auto-fix)\nruff check src/ --fix\n\n# Format\nblack src/\n\n# Type check\nmypy src/\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run these before every commit. CI will reject PRs that fail linting or type checks."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Run all tests\npytest\n\n# Run with coverage\npytest --cov=src --cov-report=term-missing\n\n# Run a specific test file\npytest tests/test_middlewares.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"When adding new functionality:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Write unit tests for pure functions and utilities"}),"\n",(0,r.jsxs)(n.li,{children:["Write integration tests that call ",(0,r.jsx)(n.code,{children:"create_copilot()"})," with a mock input and assert stream behavior"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"controller.get_state()"})," and ",(0,r.jsx)(n.code,{children:"controller.run()"})," with ",(0,r.jsx)(n.code,{children:"serialize=True"})," for snapshot tests"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pr-workflow",children:"PR Workflow"}),"\n",(0,r.jsx)(n.mermaid,{value:"flowchart TD\n  A[Fork repo + create branch] --\x3e B[Implement changes]\n  B --\x3e C[Run ruff + black + mypy]\n  C --\x3e D[Run tests]\n  D --\x3e E[Open PR to main]\n  E --\x3e F[CI runs checks]\n  F --\x3e G{Pass?}\n  G -- Yes --\x3e H[Code review]\n  G -- No --\x3e B\n  H --\x3e I[Address feedback]\n  I --\x3e J[Merge]"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fork"})," the repository and create a feature branch from ",(0,r.jsx)(n.code,{children:"main"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git checkout -b feature/my-feature\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Make your changes"})," \u2014 keep commits focused and atomic."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Run checks locally:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ruff check src/ --fix && black src/ && mypy src/ && pytest\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Open a PR"})," to ",(0,r.jsx)(n.code,{children:"main"})," with a clear description of:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"What problem this solves"}),"\n",(0,r.jsx)(n.li,{children:"How it was implemented"}),"\n",(0,r.jsx)(n.li,{children:"How to test it"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CI will run"})," linting, type checks, and tests automatically."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Address review comments"})," \u2014 maintainers aim to review within a week."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"commit-message-convention",children:"Commit Message Convention"}),"\n",(0,r.jsx)(n.p,{children:"Use conventional commits:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"feat: add @harness: autocomplete trigger\nfix: prevent ToolRetryMiddleware from retrying GraphInterrupt\ndocs: expand HITL security guide\nrefactor: extract harness discovery into utils.py\ntest: add integration test for SkillsMiddleware bootstrap\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adding-a-built-in-skill",children:"Adding a Built-in Skill"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a directory under ",(0,r.jsx)(n.code,{children:"src/skills/<skill-name>/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Add a ",(0,r.jsx)(n.code,{children:"SKILL.md"})," with YAML frontmatter:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"---\nname: skill-name\ndescription: Use this skill when... [trigger conditions]. Handles [capabilities].\nlicense: MIT\n---\n# Skill Name Guide\n[Playbook instructions]\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Include any supporting reference files (",(0,r.jsx)(n.code,{children:"REFERENCE.md"}),", ",(0,r.jsx)(n.code,{children:"FORMS.md"}),", etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:["Test by running Ciri \u2014 ",(0,r.jsx)(n.code,{children:"SkillsMiddleware"})," bootstraps from ",(0,r.jsx)(n.code,{children:"src/skills/"})," on first run"]}),"\n",(0,r.jsx)(n.li,{children:"Open a PR with the new skill directory"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Quality bar for built-in skills:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"description"})," must be trigger-condition-oriented (not a feature list)"]}),"\n",(0,r.jsx)(n.li,{children:"Playbook must be actionable with concrete examples"}),"\n",(0,r.jsx)(n.li,{children:"No dependencies on private/internal APIs"}),"\n",(0,r.jsx)(n.li,{children:"Include a license compatible with the project"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adding-a-built-in-subagent",children:"Adding a Built-in Subagent"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add implementation to ",(0,r.jsx)(n.code,{children:"src/subagents/<subagent-name>.py"})]}),"\n",(0,r.jsxs)(n.li,{children:["Register in ",(0,r.jsx)(n.code,{children:"src/copilot.py"})," alongside the other builder subagents"]}),"\n",(0,r.jsx)(n.li,{children:"If it needs a YAML config template, add it to the appropriate location"}),"\n",(0,r.jsx)(n.li,{children:"Add tests that verify the subagent builds and produces valid output"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adding-a-middleware",children:"Adding a Middleware"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Extend ",(0,r.jsx)(n.code,{children:"AgentMiddleware"})," from the deepagents library:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from langchain.agents.middleware import AgentMiddleware\n\nclass MyMiddleware(AgentMiddleware):\n    def wrap_model_call(self, request, handler):\n        request.system_prompt += "\\n\\nMy injected context"\n        return handler(request)\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Register in ",(0,r.jsx)(n.code,{children:"create_copilot()"})," in ",(0,r.jsx)(n.code,{children:"src/copilot.py"})]}),"\n",(0,r.jsxs)(n.li,{children:["Add documentation in ",(0,r.jsx)(n.code,{children:"docs-site/docs/internals/middlewares.md"})]}),"\n",(0,r.jsx)(n.li,{children:"Add tests covering the middleware's behavior in isolation"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"documentation",children:"Documentation"}),"\n",(0,r.jsxs)(n.p,{children:["The docs site lives in ",(0,r.jsx)(n.code,{children:"docs-site/"})," (Docusaurus 3). To run locally:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd docs-site\nnpm install\nnpm start\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The site will be at ",(0,r.jsx)(n.code,{children:"http://localhost:3000"}),". Hot-reload is enabled."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Documentation standards:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Write from Ciri\'s perspective \u2014 "Ciri does X" not "the system does X"'}),"\n",(0,r.jsx)(n.li,{children:"Include Mermaid diagrams for architecture and sequence flows"}),"\n",(0,r.jsx)(n.li,{children:"Keep individual pages under 300 lines"}),"\n",(0,r.jsxs)(n.li,{children:["Link to source files (e.g., ",(0,r.jsx)(n.code,{children:"src/middlewares/skills.py"}),") for accuracy"]}),"\n",(0,r.jsx)(n.li,{children:"Every new feature needs a corresponding docs page before merge"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"reporting-bugs",children:"Reporting Bugs"}),"\n",(0,r.jsx)(n.p,{children:"When opening a bug report, include:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Steps to reproduce"})," \u2014 minimal, exact steps"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Expected behavior"})," \u2014 what should happen"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actual behavior"})," \u2014 what actually happens, including any error output"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"OS and version"}),"\n",(0,r.jsxs)(n.li,{children:["Python version (",(0,r.jsx)(n.code,{children:"python --version"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Ciri version (",(0,r.jsx)(n.code,{children:"pip show ciri"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Model provider and model name"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Logs"})," \u2014 relevant lines from the terminal output"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Use GitHub Issues: ",(0,r.jsx)(n.a,{href:"https://github.com/adimis-ai/ciri/issues",children:"github.com/adimis-ai/ciri/issues"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"code-of-conduct",children:"Code of Conduct"}),"\n",(0,r.jsx)(n.p,{children:"Be respectful. We're building something useful together. Harassment, discrimination, or bad-faith arguments are not welcome."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>d});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);