"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[7439],{2952(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"features/hitl","title":"Human-in-the-Loop (HITL)","description":"Ciri\'s Human-in-the-Loop system is a mandatory safety gate built into the HumanInTheLoopMiddleware at the LangGraph level. Before Ciri executes any consequential action \u2014 writing a file, running a script, calling an external service \u2014 she pauses and presents a richly formatted approval prompt. You inspect, approve, edit, or reject every proposed action.","source":"@site/docs/features/hitl.md","sourceDirName":"features","slug":"/features/hitl","permalink":"/docs/features/hitl","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/features/hitl.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Persistent Workspace Memory","permalink":"/docs/features/memory"},"next":{"title":"Autocomplete & Context Triggers","permalink":"/docs/features/autocomplete"}}');var i=r(4848),s=r(8453);const o={},a="Human-in-the-Loop (HITL)",l={},c=[{value:"How HITL Works",id:"how-hitl-works",level:2},{value:"Default Interrupt Triggers",id:"default-interrupt-triggers",level:2},{value:"The Approval Panel",id:"the-approval-panel",level:2},{value:"Response Options",id:"response-options",level:3},{value:"Script Execution Approval",id:"script-execution-approval",level:2},{value:"Clarification Interrupts",id:"clarification-interrupts",level:2},{value:"<code>all_allowed</code> Mode",id:"all_allowed-mode",level:2},{value:"Customizing Interrupt Triggers",id:"customizing-interrupt-triggers",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"human-in-the-loop-hitl",children:"Human-in-the-Loop (HITL)"})}),"\n",(0,i.jsxs)(n.p,{children:["Ciri's Human-in-the-Loop system is a ",(0,i.jsx)(n.strong,{children:"mandatory safety gate"})," built into the ",(0,i.jsx)(n.code,{children:"HumanInTheLoopMiddleware"})," at the LangGraph level. Before Ciri executes any consequential action \u2014 writing a file, running a script, calling an external service \u2014 she pauses and presents a richly formatted approval prompt. You inspect, approve, edit, or reject every proposed action."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-hitl-works",children:"How HITL Works"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant User\n  participant Ciri\n  participant HITL as HumanInTheLoopMiddleware\n  participant Tool\n\n  Ciri->>HITL: proposes tool call (write_file, execute, etc.)\n  HITL->>User: renders approval panel (Rich CLI)\n  User->>HITL: Approve / Edit / Reject\n  alt Approved\n    HITL->>Tool: executes with original args\n  else Edited\n    User->>HITL: modifies JSON args\n    HITL->>Tool: executes with edited args\n  else Rejected\n    HITL->>Ciri: rejection signal\n    Ciri->>User: proposes alternative\n  end"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"default-interrupt-triggers",children:"Default Interrupt Triggers"}),"\n",(0,i.jsxs)(n.p,{children:["These tool calls require approval by default. The list is configured in ",(0,i.jsx)(n.code,{children:"create_copilot()"})," in ",(0,i.jsx)(n.code,{children:"src/copilot.py"}),":"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Tool"}),(0,i.jsx)(n.th,{children:"When It Fires"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"execute"})}),(0,i.jsx)(n.td,{children:"Any shell command"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"edit_file"})}),(0,i.jsx)(n.td,{children:"Modifying an existing file"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"write_file"})}),(0,i.jsx)(n.td,{children:"Creating a new file"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"the-approval-panel",children:"The Approval Panel"}),"\n",(0,i.jsx)(n.p,{children:"When Ciri wants to take an action, you see a panel like this in the terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551  \ud83d\udd12 Tool Execution Approval Required                      \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  \u2699\ufe0f  write_file                                           \u2551\n\u2551  Write content to a file at the given path               \u2551\n\u2551                                                          \u2551\n\u2551  {                                                       \u2551\n\u2551    "path": "src/services/billing.py",                    \u2551\n\u2551    "content": "import stripe\\n..."                       \u2551\n\u2551  }                                                       \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  [1] Approve    [2] Edit args    [3] Reject              \u2551\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-options",children:"Response Options"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1 \u2014 Approve"}),": Ciri executes exactly as proposed. This is the most common response when the plan looks correct."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2 \u2014 Edit"}),": The panel enters edit mode, showing the raw JSON arguments. You modify them directly \u2014 for example, changing a file path, adjusting a command, or redacting sensitive data. After saving, Ciri validates the JSON and executes with your modified args."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"3 \u2014 Reject"}),": Ciri does not execute. She receives a rejection signal and typically proposes an alternative approach in her next message."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"script-execution-approval",children:"Script Execution Approval"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"execute_script"})," tool (sandboxed Python/JavaScript runner) has an extended approval panel that shows:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Syntax-highlighted script content"})," \u2014 see exactly what will run"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Language"})," \u2014 Python or JavaScript"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dependencies"})," \u2014 packages to be installed in the isolated venv"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Working directory"})," \u2014 where the script runs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Output directory"})," \u2014 where results are written"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timeout"})," \u2014 maximum execution time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleanup"})," \u2014 whether the venv is deleted after execution"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551  \ud83d\udcdc Script Execution Approval                             \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  Language: Python                                        \u2551\n\u2551  Dependencies: pandas, openpyxl                          \u2551\n\u2551  Timeout: 120s  |  Cleanup: true                         \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  import pandas as pd                                     \u2551\n\u2551  df = pd.read_excel("data.xlsx")                         \u2551\n\u2551  summary = df.describe()                                 \u2551\n\u2551  summary.to_csv("output/summary.csv")                    \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  [1] Approve    [2] Reject                               \u2551\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u2192 ",(0,i.jsx)(n.a,{href:"/docs/features/script-executor",children:"Script Executor Guide"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"clarification-interrupts",children:"Clarification Interrupts"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes Ciri is uncertain about your intent and stops to ask a clarifying question before acting. These ",(0,i.jsx)(n.strong,{children:"human_follow_up"})," interrupts look different from tool approval prompts:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551  \u2753 Clarification Needed                                  \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551  Should I update all environments or only production?    \u2551\n\u2551                                                          \u2551\n\u2551  1. Update production only                               \u2551\n\u2551  2. Update all environments (staging + production)       \u2551\n\u2551  3. Show me a diff first                                 \u2551\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\nYou >\n"})}),"\n",(0,i.jsx)(n.p,{children:"Type the number of your choice or enter your own free-text response."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"all_allowed-mode",children:[(0,i.jsx)(n.code,{children:"all_allowed"})," Mode"]}),"\n",(0,i.jsx)(n.p,{children:"For automated pipelines or CI environments where you trust Ciri fully, you can disable HITL:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"graph = await create_copilot(all_allowed=True)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"all_allowed=True"})," removes ALL approval gates. Only use this in fully controlled, sandboxed environments where you own the input stream entirely."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"customizing-interrupt-triggers",children:"Customizing Interrupt Triggers"}),"\n",(0,i.jsx)(n.p,{children:"You can configure which tools trigger HITL when building a custom Ciri instance:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'graph = await create_copilot(\n    interrupt_on={\n        "execute": True,\n        "edit_file": True,\n        "write_file": True,\n        "send_email": True,          # custom tool\n        "update_crm": {              # InterruptOnConfig: custom conditions\n            "when": "always"\n        },\n    }\n)\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>a});var t=r(6540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);