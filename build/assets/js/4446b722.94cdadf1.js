"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[5268],{7331(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"subagents-guide","title":"SubAgents & Delegation","description":"SubAgents are specialized agent instances with their own system prompt, tool scope, and reasoning context. Where Ciri is a generalist, a subagent is an expert called in for a specific class of task. The SubAgentMiddleware manages routing, handoff, and result integration.","source":"@site/docs/subagents-guide.md","sourceDirName":".","slug":"/subagents-guide","permalink":"/docs/subagents-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/subagents-guide.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Toolkits Guide (MCP)","permalink":"/docs/toolkits-guide"},"next":{"title":"Architecture Overview","permalink":"/docs/architecture/overview"}}');var r=n(4848),t=n(8453);const l={},d="SubAgents & Delegation",c={},a=[{value:"Built-in SubAgents",id:"built-in-subagents",level:2},{value:"<code>web_researcher</code>",id:"web_researcher",level:3},{value:"<code>skill_builder</code>",id:"skill_builder",level:3},{value:"<code>toolkit_builder</code>",id:"toolkit_builder",level:3},{value:"<code>subagent_builder</code>",id:"subagent_builder",level:3},{value:"<code>trainer_agent</code>",id:"trainer_agent",level:3},{value:"The Delegation Pattern",id:"the-delegation-pattern",level:2},{value:"Creating Custom SubAgents",id:"creating-custom-subagents",level:2},{value:"Via Ciri",id:"via-ciri",level:3},{value:"YAML Configuration",id:"yaml-configuration",level:3},{value:"YAML Schema Reference",id:"yaml-schema-reference",level:3},{value:"SubAgent Discovery Order",id:"subagent-discovery-order",level:2},{value:"Referencing SubAgents Directly",id:"referencing-subagents-directly",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"subagents--delegation",children:"SubAgents & Delegation"})}),"\n",(0,r.jsxs)(s.p,{children:["SubAgents are ",(0,r.jsx)(s.strong,{children:"specialized agent instances"})," with their own system prompt, tool scope, and reasoning context. Where Ciri is a generalist, a subagent is an expert called in for a specific class of task. The ",(0,r.jsx)(s.code,{children:"SubAgentMiddleware"})," manages routing, handoff, and result integration."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"built-in-subagents",children:"Built-in SubAgents"}),"\n",(0,r.jsx)(s.p,{children:"CIRI ships with five built-in subagents that are always available:"}),"\n",(0,r.jsx)(s.h3,{id:"web_researcher",children:(0,r.jsx)(s.code,{children:"web_researcher"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Any task requiring live internet data, authenticated browsing, or multi-page web extraction."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Capabilities:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Operates your real browser (Chrome/Edge) via CDP \u2014 uses your actual cookies, sessions, and login state"}),"\n",(0,r.jsx)(s.li,{children:"Navigates JavaScript-heavy SPAs with network-idle waiting"}),"\n",(0,r.jsx)(s.li,{children:"Performs DuckDuckGo searches and follows result links"}),"\n",(0,r.jsxs)(s.li,{children:["Extracts, cleans, and summarizes content at scale using ",(0,r.jsx)(s.code,{children:"crawl4ai"})]}),"\n",(0,r.jsx)(s.li,{children:"Can access private resources: AWS console, internal wikis, authenticated APIs"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Trigger phrases:"}),' "research", "find online", "look up", "what\'s the latest", "browse to", "check [website]"']}),"\n",(0,r.jsxs)(s.p,{children:["\u2192 ",(0,r.jsx)(s.a,{href:"/docs/features/web-research",children:"Web Research Guide"})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"skill_builder",children:(0,r.jsx)(s.code,{children:"skill_builder"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Create new reusable skill packages."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Capabilities:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Scaffolds complete skill directories (SKILL.md, scripts/, references/)"}),"\n",(0,r.jsx)(s.li,{children:"Writes comprehensive playbooks based on domain analysis"}),"\n",(0,r.jsx)(s.li,{children:"Produces tested Python helper scripts"}),"\n",(0,r.jsxs)(s.li,{children:["Uses the ",(0,r.jsx)(s.code,{children:"skill-creator"})," and ",(0,r.jsx)(s.code,{children:"mcp-builder"})," built-in skills internally"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Trigger phrases:"}),' "create a skill", "add a skill", "teach Ciri how to", "build a skill for"']}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"toolkit_builder",children:(0,r.jsx)(s.code,{children:"toolkit_builder"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Create new MCP server toolkits for external service integration."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Capabilities:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Generates Python (FastMCP) or TypeScript (MCP SDK) MCP servers"}),"\n",(0,r.jsx)(s.li,{children:"Implements tool handlers with proper input validation"}),"\n",(0,r.jsx)(s.li,{children:"Tests connectivity and tool execution"}),"\n",(0,r.jsxs)(s.li,{children:["Configures secrets via ",(0,r.jsx)(s.code,{children:".env"})," files"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Trigger phrases:"}),' "build a toolkit", "connect to [service]", "create an MCP server", "integrate with [API]"']}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"subagent_builder",children:(0,r.jsx)(s.code,{children:"subagent_builder"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Create new specialized subagent configurations."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Capabilities:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Designs YAML/JSON subagent configs with appropriate system prompts"}),"\n",(0,r.jsx)(s.li,{children:"Selects the right tool scope for the role"}),"\n",(0,r.jsx)(s.li,{children:"Recommends model choices (faster/cheaper models for narrow tasks)"}),"\n",(0,r.jsx)(s.li,{children:"Validates that the described role is distinct from existing subagents"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Trigger phrases:"}),' "create a subagent", "add a specialized agent", "define a new role for"']}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"trainer_agent",children:(0,r.jsx)(s.code,{children:"trainer_agent"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Purpose:"})," Orchestrate the full self-evolution cycle. Invoked by ",(0,r.jsx)(s.code,{children:"/sync"}),"."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"The AUDIT \u2192 ANALYZE \u2192 PLAN \u2192 BUILD \u2192 VERIFY loop:"})}),"\n",(0,r.jsx)(s.mermaid,{value:"flowchart LR\n  A[AUDIT\\nInventory existing\\nSkills/Toolkits/SubAgents] --\x3e B[ANALYZE\\nIdentify capability gaps\\nfor this workspace]\n  B --\x3e C[PLAN\\nDesign the intervention:\\nSkill vs Toolkit vs SubAgent]\n  C --\x3e D[BUILD\\nDelegate to skill_builder,\\ntoolkit_builder, or subagent_builder]\n  D --\x3e E[VERIFY\\nConfirm outputs are\\ncomplete and working]\n  E --\x3e F[UPDATE MEMORY\\nWrite/update AGENT.md\\nand topic memory files]"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Memory files the Trainer creates/updates:"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Content"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AGENT.md"})}),(0,r.jsx)(s.td,{children:"Master workspace index \u2014 overview, structure, common tasks"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"architecture.md"})}),(0,r.jsx)(s.td,{children:"Module breakdown, data flow, key dependencies"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"conventions.md"})}),(0,r.jsx)(s.td,{children:"Code style, naming, communication tone"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"domain.md"})}),(0,r.jsx)(s.td,{children:"Business concepts, glossary, key entities"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"workflows.md"})}),(0,r.jsx)(s.td,{children:"Recurring processes and how they work"})]})]})]}),"\n",(0,r.jsxs)(s.p,{children:["\u2192 ",(0,r.jsx)(s.a,{href:"/docs/internals/self-evolution",children:"Self-Evolution Deep Dive"})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"the-delegation-pattern",children:"The Delegation Pattern"}),"\n",(0,r.jsxs)(s.p,{children:["Ciri uses a ",(0,r.jsx)(s.strong,{children:"Router-Specialist"})," pattern:"]}),"\n",(0,r.jsx)(s.mermaid,{value:'sequenceDiagram\n  participant User\n  participant Ciri as Main Copilot\n  participant Router as SubAgentMiddleware\n  participant SA as Specialized SubAgent\n\n  User->>Ciri: "Research Q1 SaaS pricing benchmarks"\n  Ciri->>Router: evaluate \u2014 does this match a subagent\'s description?\n  Router->>SA: delegate to web_researcher\n  SA->>SA: multi-step browsing, extraction, synthesis\n  SA--\x3e>Ciri: structured result\n  Ciri--\x3e>User: formatted response with citations'}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Main Copilot"})," receives the request"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"SubAgentMiddleware"})," evaluates whether any registered subagent's ",(0,r.jsx)(s.code,{children:"description"})," matches the task"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Handoff"}),": state is transferred to the best-fit subagent"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Execution"}),": the subagent works (potentially many steps) with its own tool scope"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Return"}),": result is handed back to the main copilot for final formatting"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"creating-custom-subagents",children:"Creating Custom SubAgents"}),"\n",(0,r.jsx)(s.h3,{id:"via-ciri",children:"Via Ciri"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"You > Create a subagent for processing our weekly expense reports\nYou > Build a specialist for analyzing legal contract clauses\nYou > Define a dedicated subagent for our customer support escalation workflow\n"})}),"\n",(0,r.jsx)(s.h3,{id:"yaml-configuration",children:"YAML Configuration"}),"\n",(0,r.jsxs)(s.p,{children:["Create ",(0,r.jsx)(s.code,{children:".ciri/subagents/my-specialist.yaml"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"name: expense-analyst\ndescription: |\n  Delegate to this subagent when the user wants to process, categorize, or\n  summarize expense reports, receipts, or reimbursement requests.\n  Triggers: expense report, receipt processing, reimbursement, T&E analysis.\nsystem_prompt: |\n  You are an expert expense analyst with deep knowledge of corporate T&E policies.\n  When processing expense reports:\n  1. Extract itemized expenses with dates, amounts, and categories\n  2. Flag policy violations (per diem limits, prohibited categories)\n  3. Produce a structured summary with totals by category\n  4. Suggest approval or query for each flagged item\n\n  Always output structured JSON for the summary.\nmodel: openai/gpt-4o-mini   # cheaper model for structured extraction\ntools:\n  - read_file\n  - write_file\n  - execute_script\ninterrupt_on:\n  write_file: true\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Then run ",(0,r.jsx)(s.code,{children:"/sync"})," to register."]}),"\n",(0,r.jsx)(s.h3,{id:"yaml-schema-reference",children:"YAML Schema Reference"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Required"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"name"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"Yes"}),(0,r.jsxs)(s.td,{children:["Unique identifier used in ",(0,r.jsx)(s.code,{children:"@subagents:"})," autocomplete"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"description"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"Yes"}),(0,r.jsx)(s.td,{children:"Routing trigger \u2014 when should Ciri delegate here?"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"system_prompt"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"Yes"}),(0,r.jsx)(s.td,{children:"The subagent's persona, expertise, and instructions"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"model"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsx)(s.td,{children:"Override model (e.g. cheaper for narrow tasks)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"tools"})}),(0,r.jsxs)(s.td,{children:["list or ",(0,r.jsx)(s.code,{children:'"all"'})]}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsxs)(s.td,{children:["Tool names to allow. ",(0,r.jsx)(s.code,{children:'"all"'})," gives full access"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"interrupt_on"})}),(0,r.jsx)(s.td,{children:"dict"}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsx)(s.td,{children:"Which tool calls require HITL approval"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"subagent-discovery-order",children:"SubAgent Discovery Order"}),"\n",(0,r.jsx)(s.p,{children:"SubAgents are discovered from:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Core harness (",(0,r.jsx)(s.code,{children:"~/.local/share/ciri/subagents/*.{yaml,yml,json}"}),") \u2014 global"]}),"\n",(0,r.jsxs)(s.li,{children:["Project harness (",(0,r.jsx)(s.code,{children:".ciri/subagents/*.{yaml,yml,json}"}),") \u2014 project-specific"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Deduplication is by ",(0,r.jsx)(s.strong,{children:"file stem"})," (filename without extension). If ",(0,r.jsx)(s.code,{children:"researcher.yaml"})," exists in both harness levels, the ",(0,r.jsx)(s.strong,{children:"core harness version wins"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"The five built-in subagents are always registered as compiled subagents \u2014 they cannot be accidentally overridden."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"referencing-subagents-directly",children:"Referencing SubAgents Directly"}),"\n",(0,r.jsxs)(s.p,{children:["You can bypass the router and target a subagent explicitly using the ",(0,r.jsx)(s.code,{children:"@subagents:"})," trigger:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"You > @subagents:web_researcher \u2014 find all GDPR enforcement actions issued in Q4 2025\nYou > @subagents:expense-analyst \u2014 process the PDF attached to this thread\n"})}),"\n",(0,r.jsx)(s.p,{children:"This is useful when you know exactly which specialist you want and want to skip routing overhead."})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,s,n){n.d(s,{R:()=>l,x:()=>d});var i=n(6540);const r={},t=i.createContext(r);function l(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);