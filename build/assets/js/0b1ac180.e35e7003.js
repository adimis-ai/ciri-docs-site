"use strict";(self.webpackChunkciri_docs=self.webpackChunkciri_docs||[]).push([[5863],{6264(e,r,s){s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"architecture/overview","title":"Architecture Overview","description":"CIRI is a local-first, multi-agent orchestration system built on LangChain and LangGraph. Its core design principle is extensibility: every capability can be added, modified, or replaced at runtime without restarting.","source":"@site/docs/architecture/overview.md","sourceDirName":"architecture","slug":"/architecture/overview","permalink":"/docs/architecture/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/adimis-ai/ciri/tree/main/docs-site/docs/architecture/overview.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SubAgents & Delegation","permalink":"/docs/subagents-guide"},"next":{"title":"Core Harness Architecture","permalink":"/docs/architecture/core-harness"}}');var i=s(4848),t=s(8453);const l={},d="Architecture Overview",c={},a=[{value:"Core Module Map",id:"core-module-map",level:2},{value:"Startup Sequence",id:"startup-sequence",level:2},{value:"Middleware Stack",id:"middleware-stack",level:2},{value:"Two-Level Core Harness",id:"two-level-core-harness",level:2},{value:"Data Persistence",id:"data-persistence",level:2},{value:"Streaming Architecture",id:"streaming-architecture",level:2},{value:"Design Goals",id:"design-goals",level:2}];function o(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"architecture-overview",children:"Architecture Overview"})}),"\n",(0,i.jsxs)(r.p,{children:["CIRI is a ",(0,i.jsx)(r.strong,{children:"local-first, multi-agent orchestration system"})," built on LangChain and LangGraph. Its core design principle is extensibility: every capability can be added, modified, or replaced at runtime without restarting."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"core-module-map",children:"Core Module Map"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Module"}),(0,i.jsx)(r.th,{children:"File"}),(0,i.jsx)(r.th,{children:"Responsibility"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"CLI Entrypoint"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/__main__.py"})}),(0,i.jsx)(r.td,{children:"Rich terminal UI, Prompt Toolkit REPL, interrupt rendering, startup sequence"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Copilot Graph"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/copilot.py"})}),(0,i.jsx)(r.td,{children:"Assembles the LangGraph agent with all middlewares and subagents"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Controller"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/controller.py"})}),(0,i.jsx)(r.td,{children:"Thread management, graph execution, streaming"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Backend"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/backend.py"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"CiriBackend"})," \u2014 subprocess execution, streaming output callbacks"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Database"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/db.py"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"CopilotDatabase"})," \u2014 SQLite threads table, thread CRUD"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Serializers"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/serializers.py"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"LLMConfig"})," \u2014 multi-provider model initialization"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Middlewares"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/middlewares/"})}),(0,i.jsx)(r.td,{children:"Context injection, safety gates, dynamic capability loading"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Subagents"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/subagents/"})}),(0,i.jsx)(r.td,{children:"5 built-in specialists (web_researcher, builders, trainer)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Toolkits"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/toolkit/"})}),(0,i.jsx)(r.td,{children:"Core tools: web crawler, script executor, human follow-up"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Skills"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/skills/"})}),(0,i.jsx)(r.td,{children:"17 built-in domain playbooks"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Utils"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"src/utils.py"})}),(0,i.jsx)(r.td,{children:"App dirs, browser detection, gitignore parsing, harness discovery"})]})]})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"startup-sequence",children:"Startup Sequence"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\n  autonumber\n  participant CLI as src/__main__.py\n  participant Copilot as create_copilot()\n  participant LLM as LLM Provider\n  participant Browser as Chrome/Edge CDP\n  participant Builders as Subagent Factory\n  participant MW as Middleware Stack\n  participant Graph as LangGraph\n\n  CLI->>CLI: ensure_playwright_installed()\n  CLI->>CLI: load_all_dotenv() + setup_api_keys()\n  CLI->>Copilot: create_copilot(llm_config, ...)\n  Copilot->>LLM: llm_config.init_langchain_model()\n  Copilot->>Browser: resolve_browser_profile() + launch_browser_with_cdp()\n  Copilot->>Builders: build_web_researcher_agent(model, cdp_endpoint)\n  Copilot->>Builders: build_skill_builder_agent(web_researcher)\n  Copilot->>Builders: build_toolkit_builder_agent(web_researcher)\n  Copilot->>Builders: build_subagent_builder_agent(web_researcher)\n  Copilot->>Builders: build_trainer_agent(...)\n  Copilot->>MW: assemble middleware stack\n  Copilot->>Graph: compile state graph\n  Graph--\x3e>CLI: CompiledStateGraph\n  CLI->>CLI: wrap with CopilotController + start REPL"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"middleware-stack",children:"Middleware Stack"}),"\n",(0,i.jsx)(r.p,{children:"The middleware stack wraps every LLM call, injecting context and enforcing safety:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"User Message\n  \u2192 InjectNamesMiddleware        (tool + skill + subagent registry)\n  \u2192 MemoryMiddleware             (workspace .md files)\n  \u2192 SkillsMiddleware             (domain playbooks)\n  \u2192 SubAgentMiddleware           (delegation routing)\n  \u2192 ToolkitInjectionMiddleware   (MCP server tools)\n  \u2192 HumanInTheLoopMiddleware     (approval gates)\n  \u2192 TodoListMiddleware           (task tracking)\n  \u2192 AnthropicPromptCachingMiddleware  (token caching, Anthropic only)\n  \u2192 LLM Call\n  \u2192 ToolRetryMiddleware          (retry on failure, skip GraphInterrupt)\n  \u2192 PatchToolCallsMiddleware     (normalize cross-provider tool call format)\n  \u2192 SummarizationMiddleware      (compress long contexts)\n"})}),"\n",(0,i.jsxs)(r.p,{children:["\u2192 ",(0,i.jsx)(r.a,{href:"/docs/internals/middlewares",children:"Full Middleware Reference"})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"two-level-core-harness",children:"Two-Level Core Harness"}),"\n",(0,i.jsxs)(r.p,{children:["Skills, toolkits, subagents, and memory all follow a ",(0,i.jsx)(r.strong,{children:"two-level discovery pattern"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"~/.local/share/ciri/     \u2190 Core harness (global, all projects)\n\u2514\u2500\u2500 skills/ toolkits/ subagents/ memory/\n\n<project>/.ciri/         \u2190 Project harness (this workspace only)\n\u2514\u2500\u2500 skills/ toolkits/ subagents/ memory/\n"})}),"\n",(0,i.jsx)(r.p,{children:"Core harness always loads first. Project harness supplements or overrides on a name-basis."}),"\n",(0,i.jsxs)(r.p,{children:["\u2192 ",(0,i.jsx)(r.a,{href:"/docs/architecture/core-harness",children:"Core Harness Architecture"})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"data-persistence",children:"Data Persistence"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Data"}),(0,i.jsx)(r.th,{children:"Location"}),(0,i.jsx)(r.th,{children:"Technology"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Conversation threads"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"~/.ciri/data/ciri.db"})}),(0,i.jsxs)(r.td,{children:["SQLite (",(0,i.jsx)(r.code,{children:"threads"})," table)"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"LangGraph checkpoints"}),(0,i.jsx)(r.td,{children:"Same database"}),(0,i.jsxs)(r.td,{children:["LangGraph ",(0,i.jsx)(r.code,{children:"AsyncSqliteSaver"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"LangGraph store"}),(0,i.jsx)(r.td,{children:"Same database"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"AsyncSqliteStore"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Workspace memory"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:".ciri/memory/*.md"})}),(0,i.jsx)(r.td,{children:"Plain markdown files"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"User settings"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:".ciri/settings.json"})}),(0,i.jsx)(r.td,{children:"JSON"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"API keys"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"~/.ciri/.env"})," + OS keychain"]}),(0,i.jsxs)(r.td,{children:["dotenv + ",(0,i.jsx)(r.code,{children:"keyring"})]})]})]})]}),"\n",(0,i.jsxs)(r.p,{children:["The SQLite database supports ",(0,i.jsx)(r.strong,{children:"resume-from-checkpoint"})," \u2014 Ciri can continue any thread from exactly where it left off after a restart."]}),"\n",(0,i.jsx)(r.p,{children:"Thread persistence is handled by a local SQLite database."}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"streaming-architecture",children:"Streaming Architecture"}),"\n",(0,i.jsx)(r.p,{children:"Ciri streams responses in real time using LangGraph's dual-mode streaming:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:'["updates", "messages"]\n  updates  \u2192 node state changes + GraphInterrupt signals\n  messages \u2192 AIMessageChunk tokens (token-by-token text streaming)\n'})}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"CopilotController.run()"})," method yields these events to the CLI, which renders them via Rich as they arrive."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"design-goals",children:"Design Goals"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Autonomy"})," \u2014 High agency to plan and execute multi-step tasks across any domain"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Self-Evolution"})," \u2014 Permanent capability expansion via Skills, Toolkits, and SubAgents"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Workspace-Awareness"})," \u2014 Deep integration with local files, memory, and domain context"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Safety"})," \u2014 Mandatory Human-in-the-Loop for consequential actions"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Extensibility"})," \u2014 Every layer is pluggable: LLM provider, middleware, subagent, skill"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Local-First"})," \u2014 No cloud dependency for core function; all data stored locally"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,r,s){s.d(r,{R:()=>l,x:()=>d});var n=s(6540);const i={},t=n.createContext(i);function l(e){const r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);